<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <style>
      .problem_block{
        display: flex;
      }
      .advice_block{
        display: flex;
      }
      textarea{
        width: 500px;
      }
      form{
        display: flex;
        justify-content: center;
        align-items: center;
      }
     hr{
      border-top: 1px dotted #8c8b8b;
      border-bottom: 1px dotted #fff;
     }
    </style>
  </head>
  <body>

  
      <div style="display: flex">
        
        <form style="width: 1850px; margin: 20px"  action="api/add" method="post">
          
          <div class="form-group" style="width:850px" >
          
            <h2>請輸入使用者名稱及樣本編號</h2>
            <div class="input-group input-group-lg"style="width: 300px;" >

            
              <div class="input-group-prepend" >
             
                <span class="input-group-text" id="inputGroup-sizing-lg"
                  >user</span
                >
              </div>
              <input
              maxlength="9"
                type="text"
                class="form-control"
                aria-label="Large"
                id="user"
                aria-describedby="inputGroup-sizing-sm" 
                
              />
            </div>
            <br>
            <div class="input-group input-group-lg" style="width: 500px;" >

              
              <div class="input-group-prepend" >
                
                <span class="input-group-text" id="inputGroup-sizing-lg"
                  >SampleId</span
                >
              </div>
              <input
              maxlength="9"
                type="text"
                class="form-control"
                aria-label="Large"
                id="sampleid"
                aria-describedby="inputGroup-sizing-sm" 
               
              />
            </div>
            <hr >
  <h3>樣本問題</h3>
  <section  class="problem__block">
   
    <div style="display: colomn; width: 850px">
  
      <div style="display: flex;">

      <div style="height:50px ;">
        <select class="form-select" aria-label="Default select example">
        
          <option value="Visual">Visual 問題</option>
          <option value="Photo">Photo 問題</option>
          <option value="DNA">DNA 問題</option>
        </select>
      </div>
    
      
        
        </div>

        <!-- <br /> -->
        <div>
          <div class="problem_block">
            <div class="problems" style="display: flex;margin-right:20px;width:1800px">
           
              <div style="margin-right:20px">
                <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">問題描述(短)</label>
                <input type="text" class="shortproblem"  name="shortproblem" maxlength="50">
              </div>
              <div>
                <label for="exampleFormControlSelect1"    style="margin-right:20px;">問題描述(長)</label>
             
                <textarea  maxlength="50"
                class="form-control"
                name="longproblem"
                id="exampleFormControlTextarea1"
                rows="3"
                style="width: 600px;"
              ></textarea>
              </div>
           
          </div>
        </div>
       
    
    
  </div>
  <div style="margin: 10px;">
    <input class="btn btn-primary problem_add" type="button"  value="增加問題描述" />
  </div>
  <hr>
  <h3>改善建議</h3>
<div >
  <div class="advice_block">
    <div  style="display: flex;margin-right:20px;width:500px">
   
      <div style="margin-right:20px">
        <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">改善建議(短)</label>
        <input type="text" name="adviseshort" class="adviseshort" maxlength="50">
      </div>
      <div>
        <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
     
        <textarea  maxlength="50"
        class="form-control adviselong"
        name="adviseshort"
        id="exampleFormControlTextarea1"
        rows="3"
        style="width: 600px;"
      ></textarea>
      </div>       
    </div>
  </div>

</div>
   
  <div style="margin: 10px;">
    <input class="btn btn-primary add_advice" type="button"  value="添加建議" />
  </div>     
   </section>  
     
       
  
 
     
 <div class="other"></div>   
        
     
 <hr style="border: 1px solid black;">
   <input class="btn btn-primary add_one" type="button"  value="增加樣本問題" />
          <input class="btn btn-primary" type="button" id="submit" value="提交" />
      
    </form>
  
    
  </body>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
   
    $( document ).ready(function() {
     
      $(".problem_add").click(function(){    
        $(`    
        <div class="problem_block">
          <div class="problems" style="display: flex;margin-right:20px;width:500px">
         
            <div style="margin-right:20px">
              <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">問題描述(短)</label>
              <input type="text" maxlength="50" class="shortproblem">
            </div>
            <div>
              <label for="exampleFormControlSelect1"  style="margin-right:20px;">問題描述(長)</label>
           
              <textarea  maxlength="50"
              class="form-control"
              name="visuallong"
              style="width: 600px;"
              id="exampleFormControlTextarea1"
              rows="3"
            ></textarea>
            </div>
           
        </div>
     
        
     
        </div>
            `).appendTo($(this).parent().prev())
      });
    
      $(".add_advice").click(function(){    
        $(`    <div>
          <div  style="display: flex;margin-right:20px;width:500px">
         
            <div style="margin-right:20px">
              <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">改善建議(短)</label>
              <input type="text" class="adviseshort" name="adviseshort" maxlength="50">
            </div>
            <div>
              <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
           
              <textarea  maxlength="50"
              class="form-control adviselong"
              name="adviseshlong"
              style="width: 600px;"
              id="exampleFormControlTextarea1"
              rows="3"
            ></textarea>
            </div>       
          </div>
        </div>
          
         `).appendTo($(this).parent().prev())

       
      });

      $(".add_one").click(function(){   
      
        let is=  $(`
        
      <hr style="border: 1px solid black;">
      <h3>樣本問題</h3>
      <section  class="problem__block">
       
        <div style="display: colomn; width: 600px">
      
          <div style="display: flex;">
    
          <div style="height:50px ;">
            <select class="form-select" aria-label="Default select example">
       
              <option value="Visual">Visual 問題</option>
              <option value="Photo">Photo 問題</option>
              <option value="DNA">DNA 問題</option>
            </select>
          </div>
        
          
            
            </div>
    
            <!-- <br /> -->
            <div>
              <div class="problem_block">
                <div class="problems" style="display: flex;margin-right:20px;width:1800px">
               
                  <div style="margin-right:20px">
                    <label for="exampleFormControlSelect1" name="shortproblem" style="display: flex;margin-right:20px">問題描述(短)</label>
                    <input type="text" class="shortproblem" maxlength="50">
                  </div>
                  <div>
                    <label for="exampleFormControlSelect1"  style="margin-right:20px;">問題描述(長)</label>
                 
                    <textarea  maxlength="50"
                    class="form-control"
                    name="longproblem"
                    style="width: 600px;"
                    id="exampleFormControlTextarea1"
                    rows="3"
                  ></textarea>
                  </div>
               
              </div>
            </div>
           
       
    
    
        
      </div>

       
      <div style="margin: 10px;">
        <input class="btn btn-primary problem_add" type="button"   value="增加問題描述" />
      </div>
      <hr >
      <h3>改善建議</h3>
    
    <div>
      <div class="advice_block">
        <div  style="display: flex;margin-right:20px;width:500px">
       
          <div style="margin-right:20px">
            <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">改善建議(短)</label>
            <input type="text" maxlength="50" name="adviseshort" class="adviseshort">
          </div>
          <div>
            <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
         
            <textarea  maxlength="50"
            class="form-control adviselong"
            name="longproblem"
            style="width: 600px;"
            id="exampleFormControlTextarea1"
            rows="3"
          ></textarea>
          </div>       
        </div>
      </div>
    
    </div>
      
      <div style="margin: 10px;">
        <input class="btn btn-primary add_advice" type="button"  value="添加建議" />
      </div>     
       </section>  

              `).appendTo(".other")

     var addbclick=$(d3.select(is).node()[4].children[0].children[1].children[0]).parent().next()[0] 
       console.log($(d3.select(is).node()[4].children[0].children[1] ) )
      d3.select(addbclick).on("click",function(){
        $(`    
        <div class="problem_block">
          <div class="problems" style="display: flex;margin-right:20px;width:500px">
         
            <div style="margin-right:20px">
              <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">問題描述(短)</label>
              <input type="text" maxlength="50" name="shortproblem" class="shortproblem">
            </div>
            <div>
              <label for="exampleFormControlSelect1" name="longproblem"  style="margin-right:20px;">問題描述(長)</label>
           
              <textarea  maxlength="50"
              class="form-control"
              name="visuallong"
              style="width: 600px;"
              id="exampleFormControlTextarea1"
              rows="3"
            ></textarea>
            </div>
           
        </div>
     
        
     
        </div>
            `).appendTo($(d3.select(is).node()[4].children[0].children[1] ) )
     
       
       
      })

      var addOtherAdvise=$(d3.select(is).node()[4].children[0].children[1].children[0]).parent().next().next().next().next().next().children()[0]
 
      d3.select(addOtherAdvise).on("click",function(){
        $(`    
       
        <div class="advice_block">
          <div class="problems" style="display: flex;margin-right:20px;width:500px">
         
            <div style="margin-right:20px">
              <label for="exampleFormControlSelect1" name="shortproblem" style="display: flex;margin-right:20px">改善建議(短)</label>
              <input type="text" class="adviseshort" maxlength="50">
            </div>
            <div>
              <label for="exampleFormControlSelect1" name="longproblem"  style="margin-right:20px;">改善建議(長)</label>
           
              <textarea  maxlength="50"
              class="form-control adviselong"
              name="longproblem"
              style="width: 600px;"
              id="exampleFormControlTextarea1"
              rows="3"
            ></textarea>
            </div>
           
        </div>
     
        
     
        </div>
            `).appendTo($(d3.select(is).node()[4].children[0].children[1].children[0]).parent().next().next().next().next() )
     
       
       
      })
    
  
   
       
       
     
      } );
     var arrs=[]
     var arrss=[]
     var arrsss=[]
     var arrs2={}
      $("#submit") .click(function() {
       
        console.log($(".form-select").val())
        for(k of $(".form-select")){
         if($(k).val()=="Visual"){
        
          var ploblock=$(k).parent().parent().next()
          console.log(ploblock)
  
          var a1=Array.from($(ploblock).children()) 
          console.log(a1)
          a1.forEach(d=>{
            console.log(d)
            datas={}
            var vis={}
          
            console.log(    d3.select(d).select(".shortproblem").node().value)
          
            datas.Problem_short=d3.select(d).select(".shortproblem").node().value
            
               
            datas.Problem_long=d3.select(d).select(".form-control").node().value
            vis.problem = datas
            console.log(    d3.select(d).select(".form-control").node().value)
            arrs.push(vis)
         
          })
         
          var adviceblock=$(k).parent().parent().next().next() .next() .next() .next() .children()
          console.log(Array.from(adviceblock) )
         Array.from(adviceblock) .forEach(d=>{
          datas={}
          var vis={}
 
          datas.adviseshort = d3.select(d).select(".adviseshort").node().value
          datas.adviselong =  d3.select(d).select(".adviselong").node().value
        
          vis.advice = datas
          arrs.push(vis)
            console.log(    d3.select(d).select(".adviseshort").node().value)
            console.log(    d3.select(d).select(".adviselong").node().value)
            console.log(arrs)
          })
          arrs2.Visual=arrs
          console.log(arrs2)
         }else if($(k).val()=="Photo"){
     
    
          var ploblock=$(k).parent().parent().next()
        
          var a1=Array.from($(ploblock).children()) 
          a1.forEach(d=>{
            datas={}
            var photo={}
            console.log(    d3.select(d).select(".shortproblem").node().value)
            console.log(    d3.select(d).select(".form-control").node().value)
            datas.Problem_short =  d3.select(d).select(".shortproblem").node().value
            datas.Problem_long =    d3.select(d).select(".form-control").node().value
             
            photo.problem = datas
            arrss.push(photo)
          })
          var adviceblock=$(k).parent().parent().next().next() .next() .next() .next() .children()
          console.log(Array.from(adviceblock) )
         Array.from(adviceblock) .forEach(d=>{
      
          datas={}
          var photo={}
            console.log(    d3.select(d).select(".adviseshort").node().value)
            console.log(    d3.select(d).select(".adviselong").node().value)
            datas.advice_short =  d3.select(d).select(".adviseshort").node().value
            datas.advice_long =   d3.select(d).select(".adviselong").node().value
            photo.advice= datas
            arrss.push(photo)
          })
          arrs2.Photo=arrss
          console.log(arrs2)
         }else if($(k).val()=="DNA"){
          var ploblock=$(k).parent().parent().next()
        
          var a1=Array.from($(ploblock).children()) 
          a1.forEach(d=>{
     

            datas={}
        
            var DNA={}
            datas.Problem_short =   d3.select(d).select(".shortproblem").node().value
            datas.Problem_long =    d3.select(d).select(".form-control").node().value
            DNA.problem= datas
            arrsss.push(DNA)
          })

          var adviceblock=$(k).parent().parent().next().next() .next() .next() .next() .children()
          console.log(Array.from(adviceblock) )
         Array.from(adviceblock) .forEach(d=>{
          datas={}
          var DNA={}
            console.log(    d3.select(d).select(".adviseshort").node().value)
            console.log(    d3.select(d).select(".adviselong").node().value)
            datas.advice_short =  d3.select(d).select(".adviseshort").node().value
            datas.advice_long =   d3.select(d).select(".adviselong").node().value
            DNA.advice=datas
            arrsss.push(DNA)
          })
          arrs2.DNA=arrsss
          console.log(arrs2)
         }
        }
 
    console.log( $("#user").val())
    console.log($("#sampleid").val())
     
      });
    });
   
  </script>
</html>
