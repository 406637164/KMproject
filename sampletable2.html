<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <style>
      .problem_block{
        display: flex;
      }
      .advice_block{
        display: flex;
      }
      textarea{
        width: 500px;
      }
      form{
        display: flex;
    
        align-items: center;
      }
     hr{
      border-top: 1px dotted #8c8b8b;
      border-bottom: 1px dotted #fff;
     }
     .upload_zone {
      width: 200px;
      height: 200px;
      margin: 20px;
      padding: 10px;
      cursor: pointer;
      background-color: aqua;
  }
    </style>
  </head>
  <body>

  
      <div style="display: flex">
        
        <form style="width: 1850px; margin: 20px"  action="api/add" method="post">
          
          <div class="form-group" style="width:1850px" >
          
            <h2>請輸入使用者名稱及樣本編號</h2>
            <div class="input-group input-group-lg"style="width: 300px;" >

            
              <div class="input-group-prepend" >
             
                <span class="input-group-text" id="inputGroup-sizing-lg"
                  >login</span
                >
              </div>
              <input
              maxlength="20"
                type="text"
                class="form-control problemlong"
                aria-label="Large"
                id="user"
                placeholder="eg:manichols"
                aria-describedby="inputGroup-sizing-sm" 
                
              />
            </div>
            <br>
            <div class="input-group input-group-lg" style="width: 500px;" >

              
              <div class="input-group-prepend" >
                
                <span class="input-group-text" id="inputGroup-sizing-lg"
                  >id</span
                >
              </div>
              <input
              maxlength="9"
                type="text"
                class="form-control"
                placeholder="eg:105593309"
                aria-label="Large"
                id="sampleid"
                aria-describedby="inputGroup-sizing-sm" 
               
              />
            </div>
            <hr  >

  <div style="margin: 10px;">
    <span style="font-size: 1.25rem;margin-right:50px;margin-left:50px;"><b>新增問題</b></span>
    <input class="btn btn-primary problem_add" type="button" id="visualsubmit" value="新增Visual問題" />
    <input class="btn btn-primary problem_add" type="button" id="photosubmit"  value="新增Photo問題" />
    <input class="btn btn-primary problem_add" type="button" id="dnasubmit"  value="新增DNA問題" />
 
  </div>
  <hr >
  <hr  style="border:1px solid black" >
  <div>
    <table>
        <tr style="font-size: 1.25rem;height: 60px;">
            <th style="width: 180px;text-align:center">樣本問題</th>
            <th style="width: 240px;text-align:center">問題描述(短)</th>
            <th style="width: 400px;text-align:center">問題描述(長)</th>
            <th style="width: 240px;text-align:center">改善建議(短)</th>
            
            <th  style="width: 400px;text-align:center">改善建議(長)</th>
            <th  style="width: 340px;text-align:center">圖片</th>
        </tr>
        
    </table>
    
  </div>
 <hr  style="border:1px solid black">
  <section  class="Visual__block">
   
     
   </section>  
   
   <section  class="Photo__block">
    
    
   </section>  
 
   <section  class="DNA__block">
     
   </section>  
      
   
     <footer style="margin-left: 820px">
       
      <input class="btn btn-primary btn-lg" type="button" id="submit" value="送出" />
     </footer>

    
     
      
    </form>
  
    
  </body>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
  
    $( document ).ready(function() {
    
      $("#visualsubmit").click(function() {
        
        $(".Visual__block").append(`  <div style="display: colomn; width: 1850px">
          <div>
           <div class="problem_block">
               <div style="width: 200px;gap: 5px;margin-right:20px;   display: flex;justify-content: center;align-items:center;text-align:center; ">
                   <h4 style="width: 200px;">Visual問題</h4>
               </div>
                  
               
                   <div style="margin-right:30px; ">
                       <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">問題描述(短)</label>
                       <input type="text" class="shortproblem"  name="shortproblem" maxlength="50">
                   </div>
                   <div style="margin-right:40px">
                       <label for="exampleFormControlSelect1"    style="margin-right:20px;">問題描述(長)</label>
                   
                       <textarea  maxlength="50"
                       class="form-control problemlong"
                       name="longproblem"
                       id="exampleFormControlTextarea1"
                       rows="3"
                       style="width: 400px;"
                   ></textarea>
                   </div>
               
   
                   
                
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">改善建議(短)</label>
                   <input type="text" name="adviseshort" class="adviseshort" maxlength="50">
               </div>
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
               
                   <textarea  maxlength="50"
                   class="form-control adviselong"
                   name="adviseshort"
                   id="exampleFormControlTextarea1"
                   rows="3"
                   style="width: 400px;"
               ></textarea>
                 
               </div>
            
            
               <div style="padding-left:30px;margin-right:10px;display:flex">
                <div style="margin-left:30px;display:column">
                  <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">請上傳圖片</label>
                 </div>
                <div>
                  <input type="file" accept="image/*" style="margin-bottom:10px"  >
                  <img class="output" style="width:100px;height:100px" style="display:incline-block"/>
                </div>
             
               
            </div>
           </div>   
     </div>
     <hr>
        `)
      
     
   
        var len=  Array.from(d3.select(".Visual__block").node().children)  .length-1 
        itemi=Array.from(d3.select(".Visual__block").node().children)[len]
    
       var output = d3.select(itemi).select(".output").node()
         d3.select(itemi).on("change", (event)=>{
          if(event.target.files!=null){
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function() {
             URL.revokeObjectURL(output.src) // free memory
           }
          }
         
         })
      });
     

      $("#photosubmit").click(function() {
        $(".Photo__block").append(`  <div style="display: colomn; width: 1850px">
          <div>
           <div class="problem_block">
               <div style="width: 200px;gap: 5px;margin-right:20px;   display: flex;justify-content: center;align-items:center;text-align:center; ">
                   <h4 style="width: 200px;">Photo問題</h4>
               </div>
                  
               
                   <div style="margin-right:30px; ">
                       <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">問題描述(短)</label>
                       <input type="text" class="shortproblem"  name="shortproblem" maxlength="50">
                   </div>
                   <div style="margin-right:40px">
                       <label for="exampleFormControlSelect1"    style="margin-right:20px;">問題描述(長)</label>
                   
                       <textarea  maxlength="50"
                       class="form-control problemlong"
                       name="longproblem"
                       id="exampleFormControlTextarea1"
                       rows="3"
                       style="width: 400px;"
                   ></textarea>
                   </div>
               
   
                   
                
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">改善建議(短)</label>
                   <input type="text" name="adviseshort" class="adviseshort" maxlength="50">
               </div>
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
               
                   <textarea  maxlength="50"
                   class="form-control adviselong"
                   name="adviseshort"
                   id="exampleFormControlTextarea1"
                   rows="3"
                   style="width: 400px;"
               ></textarea>
                 
               </div>
         
               <div style="padding-left:30px;margin-right:10px;display:flex">
                <div style="margin-left:30px;display:column">
                  <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">請上傳圖片</label>
                 </div>
                <div>
                  <input type="file" accept="image/*" style="margin-bottom:10px"  >
                  <img class="output" style="width:100px;height:100px" style="display:incline-block"/>
                </div>
             
               
            </div>
           </div>   
     </div>
     <hr>
        `)
        var len=  Array.from(d3.select(".Photo__block").node().children)  .length-1 
        itemi=Array.from(d3.select(".Photo__block").node().children)[len]
        console.log(itemi)
   
       var output = d3.select(itemi).select(".output").node()
         d3.select(itemi).on("change", (event)=>{
          if(event.target.files!=null){
             output.src = URL.createObjectURL(event.target.files[0]);
           output.onload = function() {
            URL.revokeObjectURL(output.src) // free memory
          }
          
          }
         })
      });
      $("#dnasubmit").click(function() {
        $(".DNA__block").append(`  <div style="display: colomn; width: 1850px">
          <div>
           <div class="problem_block">
               <div style="width: 200px;gap: 5px;margin-right:20px;   display: flex;justify-content: center;align-items:center;text-align:center; ">
                   <h4 style="width: 200px;">DNA問題</h4>
               </div>
                  
               
                   <div style="margin-right:30px; ">
                       <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">問題描述(短)</label>
                       <input type="text" class="shortproblem"  name="shortproblem" maxlength="50">
                   </div>
                   <div style="margin-right:40px">
                       <label for="exampleFormControlSelect1"    style="margin-right:20px;">問題描述(長)</label>
                   
                       <textarea  maxlength="50"
                       class="form-control problemlong"
                       name="longproblem"
                       id="exampleFormControlTextarea1"
                       rows="3"
                       style="width: 400px;"
                   ></textarea>
                   </div>
               
   
                   
                
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px;margin-top:30px;">改善建議(短)</label>
                   <input type="text" name="adviseshort" class="adviseshort" maxlength="50">
               </div>
               <div style="margin-right:30px">
                   <label for="exampleFormControlSelect1"  style="margin-right:20px;">改善建議(長)</label>
               
                   <textarea  maxlength="50"
                   class="form-control adviselong"
                   name="adviseshort"
                   id="exampleFormControlTextarea1"
                   rows="3"
                   style="width: 400px;"
               ></textarea>
                 
               </div>
         
              
               <div style="padding-left:30px;margin-right:10px;display:flex">
                <div style="margin-left:30px;display:column">
                  <label for="exampleFormControlSelect1" style="display: flex;margin-right:20px">請上傳圖片</label>
                 </div>
                <div>
                  <input type="file" accept="image/*" style="margin-bottom:10px"  >
                  <img class="output" style="width:100px;height:100px" style="display:incline-block"/>
                </div>
             
               
            </div>
           </div>   
     </div>
     <hr>
     `)
   

     var len=  Array.from(d3.select(".DNA__block").node().children)  .length-1 
     itemi=Array.from(d3.select(".DNA__block").node().children)[len]
    
    var output = d3.select(itemi).select(".output").node()
      d3.select(itemi).on("change", (event)=>{

        if(event.target.files!=null){
          output.src = URL.createObjectURL(event.target.files[0]);
          output.onload = function() {
           URL.revokeObjectURL(output.src) // free memory
        }
      
       }
      }) 
      });
   
      });
   
      
      $(document).ready(function(){
        $("#submit").click(function(){
          var arr=[]
        Array.from($('.Visual__block').children().children()).forEach(d=>{
          if(d.tagName=="DIV"){
            
            data={}
            var shortproblem=  $(d.children).find('.shortproblem')[0].value 
            var  longproblem = $(d.children).find('.problemlong')[0].value  
            var  adviseshort =  $(d.children).find('.adviseshort')[0].value 
            var  adviselong =    $(d.children).find('.adviselong')[0].value 
    
            var  img =    $(d.children).find('img').attr("src") 
            data.category="Visual"
            data.shortproblem=shortproblem
            data.longproblem=longproblem
            data.adviseshort=adviseshort
            data.adviseslong=adviselong
            data.login =  $("#user").val()
            data.id =  $("#sampleid").val()
            data.img=img
      
            arr.push(data)
          }
        
        })
        Array.from($('.Photo__block').children().children()).forEach(d=>{
          if(d.tagName=="DIV"){
            
            data={}
            var shortproblem=  $(d.children).find('.shortproblem')[0].value 
            var  longproblem = $(d.children).find('.problemlong')[0].value  
            var  adviseshort =  $(d.children).find('.adviseshort')[0].value 
            var  adviselong =    $(d.children).find('.adviselong')[0].value 
            var  img =    $(d.children).find('img').attr("src") 
            data.category="Photo"
            data.shortproblem=shortproblem
            data.longproblem=longproblem
            data.adviseshort=adviseshort
            data.adviseslong=adviselong
            data.img=img
            data.login =  $("#user").val()
            data.id =  $("#sampleid").val()
            arr.push(data)
          }
        
        })
        Array.from($('.DNA__block').children().children()).forEach(d=>{
          if(d.tagName=="DIV"){
            data={}
            var shortproblem=  $(d.children).find('.shortproblem')[0].value 
            var  longproblem = $(d.children).find('.problemlong')[0].value  
            var  adviseshort =  $(d.children).find('.adviseshort')[0].value 
            var  adviselong =    $(d.children).find('.adviselong')[0].value 
            var  img =    $(d.children).find('img').attr("src") 
            data.category="DNA"
            data.shortproblem=shortproblem
            data.longproblem=longproblem
            data.adviseshort=adviseshort
            data.adviseslong=adviselong
            data.img=img
            data.login =  $("#user").val()
            data.id =  $("#sampleid").val()
            arr.push(data)
          }
        
        })
    
        console.log(arr)
        axios.post('http://localhost:3000/api/add',{
          data:arr
      })
          .then( (response) => console.log(response))
          .catch( (error) => console.log(error))
        })
     
      });
 
    
  </script>
</html>
